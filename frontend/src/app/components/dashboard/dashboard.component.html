<!-- 
  =====================================================
  DASHBOARD - PANTALLA PRINCIPAL
  Sistema Bancario FundaciÃ³n Genesis Empresarial
  ===================================================== 
-->

<div class="dashboard-container" *ngIf="!loading">
  
  <!-- Header con navegaciÃ³n -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">
          <svg width="40" height="40" viewBox="0 0 40 40">
            <circle cx="20" cy="20" r="18" fill="#fff" opacity="0.2"/>
            <path d="M20 10 L20 30 M10 20 L30 20" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
          </svg>
          <h1>Genesis<span>Bancario</span></h1>
        </div>
        <nav class="main-nav">
          <a routerLink="/dashboard" class="nav-link active">Dashboard</a>
          <a routerLink="/transacciones" class="nav-link">Transacciones</a>
          <a routerLink="/cuentas" class="nav-link">Cuentas</a>
          <a routerLink="/prestamos" class="nav-link">PrÃ©stamos</a>
        </nav>
      </div>
      
      <div class="user-section">
        <div class="notifications">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <span class="badge">3</span>
        </div>
        <div class="user-profile">
          <div class="avatar">
            <span>{{ usuario.nombre_completo.charAt(0) }}</span>
          </div>
          <div class="user-info">
            <p class="user-name">{{ usuario.nombre_completo }}</p>
            <p class="user-email">{{ usuario.email }}</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="dashboard-main">
    
    <!-- SecciÃ³n de bienvenida y resumen -->
    <section class="welcome-section">
      <div class="welcome-content">
        <h2 class="welcome-title">Bienvenido, {{ usuario.nombre_completo.split(' ')[0] }} ðŸ‘‹</h2>
        <p class="welcome-subtitle">AquÃ­ estÃ¡ el resumen de tu actividad bancaria</p>
      </div>
      
      <div class="balance-card">
        <div class="balance-header">
          <span class="balance-label">Saldo Total Disponible</span>
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
            <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="2" opacity="0.3"/>
            <path d="M16 8v16M8 16h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="balance-amount">
          <span class="currency">Q</span>
          <span class="amount">{{ saldoTotal.toLocaleString('es-GT', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) }}</span>
        </div>
        <div class="balance-footer">
          <div class="balance-change positive">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 3l5 5H3z"/>
            </svg>
            <span>+5.2% este mes</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Grid de tarjetas -->
    <section class="cards-grid">
      
      <!-- Tarjeta de acciones rÃ¡pidas -->
      <div class="action-card quick-actions">
        <h3 class="card-title">Acciones RÃ¡pidas</h3>
        <div class="actions-list">
          <button class="action-btn primary" (click)="nuevaTransferencia()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span>Nueva Transferencia</span>
          </button>
          
          <button class="action-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="5" width="20" height="14" rx="2"></rect>
              <line x1="2" y1="10" x2="22" y2="10"></line>
            </svg>
            <span>Pagar Servicios</span>
          </button>
          
          <button class="action-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"></path>
            </svg>
            <span>Depositar</span>
          </button>
          
          <button class="action-btn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 15v4a2 2 0 002 2h14a2 2 0 002-2v-4M17 9l-5 5-5-5M12 3v11"></path>
            </svg>
            <span>Retirar</span>
          </button>
        </div>
      </div>

      <!-- Tarjeta de cuentas -->
      <div class="action-card accounts-summary">
        <div class="card-header">
          <h3 class="card-title">Mis Cuentas</h3>
          <button class="view-all-btn" (click)="verCuentas()">Ver todas â†’</button>
        </div>
        
        <div class="accounts-list">
          <div class="account-item" *ngFor="let cuenta of cuentas">
            <div class="account-icon">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="6" y="8" width="20" height="16" rx="2"></rect>
                <path d="M6 12h20"></path>
                <circle cx="11" cy="17" r="1.5" fill="currentColor"></circle>
              </svg>
            </div>
            <div class="account-details">
              <p class="account-type">{{ cuenta.tipo_cuenta_nombre }}</p>
              <p class="account-number">****{{ cuenta.numero_cuenta.slice(-4) }}</p>
            </div>
            <div class="account-balance">
              <p class="balance-label">Saldo</p>
              <p class="balance-value">Q {{ cuenta.saldo.toLocaleString('es-GT', { minimumFractionDigits: 2 }) }}</p>
            </div>
          </div>
        </div>
      </div>

    </section>

    <!-- Transacciones recientes -->
    <section class="transactions-section">
      <div class="section-header">
        <h3 class="section-title">Transacciones Recientes</h3>
        <button class="view-all-btn" (click)="verTransacciones()">Ver todas â†’</button>
      </div>
      
      <div class="transactions-table">
        <div class="transaction-row" *ngFor="let transaccion of transaccionesRecientes">
          <div class="transaction-icon" [class.negative]="transaccion.monto < 0">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path *ngIf="transaccion.monto >= 0" d="M12 5v14M5 12l7-7 7 7"></path>
              <path *ngIf="transaccion.monto < 0" d="M12 19V5M5 12l7 7 7-7"></path>
            </svg>
          </div>
          
          <div class="transaction-details">
            <p class="transaction-type">{{ transaccion.tipo_nombre }}</p>
            <p class="transaction-description">{{ transaccion.descripcion }}</p>
          </div>
          
          <div class="transaction-date">
            <p>{{ transaccion.fecha_transaccion | date:'dd/MM/yyyy' }}</p>
          </div>
          
          <div class="transaction-amount" [class.negative]="transaccion.monto < 0">
            <p>{{ transaccion.monto >= 0 ? '+' : '' }}Q {{ Math.abs(transaccion.monto).toLocaleString('es-GT', { minimumFractionDigits: 2 }) }}</p>
          </div>
          
          <div class="transaction-status completed">
            <span class="status-badge">Completada</span>
          </div>
        </div>
      </div>
    </section>

    <!-- PrÃ©stamos activos -->
    <section class="loans-section" *ngIf="prestamos.length > 0">
      <h3 class="section-title">PrÃ©stamos Activos</h3>
      
      <div class="loans-grid">
        <div class="loan-card" *ngFor="let prestamo of prestamos">
          <div class="loan-header">
            <div class="loan-icon">
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 8h16v16H8z"></path>
                <path d="M4 4h24M4 28h24"></path>
              </svg>
            </div>
            <span class="loan-status active">En Pago</span>
          </div>
          
          <div class="loan-details">
            <div class="loan-amount">
              <p class="label">Monto Original</p>
              <p class="value">Q {{ prestamo.monto_aprobado.toLocaleString('es-GT', { minimumFractionDigits: 2 }) }}</p>
            </div>
            
            <div class="loan-remaining">
              <p class="label">Saldo Pendiente</p>
              <p class="value">Q {{ prestamo.saldo_pendiente.toLocaleString('es-GT', { minimumFractionDigits: 2 }) }}</p>
            </div>
          </div>
          
          <div class="loan-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="((prestamo.monto_aprobado - prestamo.saldo_pendiente) / prestamo.monto_aprobado * 100)"></div>
            </div>
            <p class="progress-text">{{ ((prestamo.monto_aprobado - prestamo.saldo_pendiente) / prestamo.monto_aprobado * 100).toFixed(1) }}% pagado</p>
          </div>
          
          <div class="loan-payment">
            <p class="label">Cuota Mensual</p>
            <p class="monthly-payment">Q {{ prestamo.cuota_mensual.toLocaleString('es-GT', { minimumFractionDigits: 2 }) }}</p>
          </div>
        </div>
      </div>
    </section>

  </main>

</div>

<!-- Loading spinner -->
<div class="loading-container" *ngIf="loading">
  <div class="spinner"></div>
  <p>Cargando dashboard...</p>
</div>
